

### Consensus

* Definition of Consensus:
  1. Termination: All normal nodes will end up in a finite number of steps and make decisions.
  2. Agreement: All nodes must reach to a common decision (Agreement); If all nodes proposed the same initial decision value, then all normal nodes should choose that value (Integrity).
  3. Validity: The final agreement must be one of the values submitted by the nodes.

* FLP Impossibility Theorem: in asynchronous communication scenarios, even if only one node fails, no
  algorithm can guarantee the consistency among the other normal nodes.

* CAP Theorem: A distributed system can deliver only two of the three desired characteristics.

1. Consistency: Consistency means that all clients see the same data at the same time, no matter which node they connect to.
2. Availability: Availability means that any client making a request for data gets a response, even if one or more nodes are broken down.
3. Partition tolerance: Partition tolerance means that the cluster must continue to work despite any number of communication breakdowns between nodes in the system.

* BASE Theory by Dan Pritchett: Achieving high availability, at the cost of weakening the strong consistency; Even if strong consistency cannot be achieved, final consistency (Eventual Consistency) can be achieved in a suitable way.



### Bitcoin PoW Consensus

The number of successful mining in time $t$ is subject to $B(bt,p)$, where $v$ is the number of hash operations in unit time.

The probability of an attacker catching up from a given deficit is analogous to a **Gambler’s Ruin problem**.

$p=\text{probability an honest node finds the next block}$

$q=\text{probability the attacker finds the next block}$

$q_z=\text{probability the attacker will ever catch up from z blocks behind}$

$q_z = \begin{cases}  1 & \text{if } p \leq q \\ (q/p)^z & \text{if } p > q  \end{cases}$

the number of blocks $k$ on the forking chain generated by the attacker after block $B_{i-1}$ satisfies the Poisson distribution with parameter $\lambda=z\frac{q}{p}$.

The probability that the forking chain can catch up $\sum_{k=0}^\infty \frac{\lambda^ke^{-\lambda}}{k!}\times \begin{cases}  (q/p)^{(z-k)} & \text{if } k \leq z \\ 1 & \text{if } k > z  \end{cases}$

Bitcoin system 6-confirmation rule is based on the assumption that the attacker’s computer power is less than 10%.



### Practical Byzantine fault tolerance algorithm(PBFT)
* **Byzantine failures:**  Components may fail and there is imperfect information on whether a component has failed.
  
* **PBFT:** For synchronous (weak synchronous) networks, solved the problem of low efficiency that the original Byzantine fault-tolerant algorithm suffers, reducing the complexity from exponential to polynomial level.



