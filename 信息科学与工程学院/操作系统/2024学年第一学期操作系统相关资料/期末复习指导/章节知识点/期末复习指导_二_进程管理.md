# **第2部分**    **进程管理**

学习重点：

##### 1、什么是进程，进程与程序的区别和关系：
​	进程：
​	==进程=程序+数据+PCB==
​	进程是可以和别的计算并发执行的计算；
​	进程是程序的一次执行，是在给定内存区域中的一组指令序列的执行过程；
​	进程是一个程序在给定活动空间和初始条件下在一个处理机上的执行过程；
​	进程可定义为一个数据结构和能在其上进行操作的一个程序；
​	进程是程序在一个数据集合上运行的过程，**是进程实体的运行过程，**它是**系统进行资源分配和调度的独立单位**。

​	==<font color="blue">**进程与程序的区别**</font>：==（P37）
​	①**程序是静态概念，而进程是程序的一次执行过程，是动态概念。**
​	②进程是一个能**独立**运行的单位，能与其它进程**并发**执行。进程是作为申请和调度单位存在的；而通常的程序是不能作为一个独立运行的单位而并发执行的。
​	③程序和进程**无**一一对应关系（==一个程序运行在不同的数据集合上时一个程序对应多个进程==；==每个线程执行一段程序，所以一个进程对应多个程序==；==如果程序是代码段的集合那么一个进程就对应多个程序==；==如果程序是一个可执行文件那么一个进程对应一个程序==）。
​	④各个进程在并发执行过程中会产生相互制约关系，而程序本身是静态的，不存在这种**异步**特征。



##### ==2、进程的两个基本属性：==
​	可**拥有资源**的独立单位、可**独立调度和分派**的基本单位



##### <font color="blue"> 3、进程的特征：</font>
​	**动态性、并发行、独立性、异步性、**结构特征

 

##### ==4、进程的基本状态及其变化：==

三种基本状态：
	**运行态**：当前进程已分配到CPU，它的程序正在处理机上运行；
	**就绪态**：进程已具备运行条件，但因为其它进程正占用CPU，所以暂时不能运行而等待分配CPU的状态；
	**阻塞态**：因等待某件事件发生而暂时不能运行的状态。

​	就绪→运行：被调度程序选中，分配到CPU。
​	运行→阻塞：因缺乏某种条件而放弃对CPU的占用。
​	阻塞→就绪：阻塞态进程所等待的事件发生了。
​	运行→就绪：进程用完时间片（分时系统中）或一个优先权更高的进程进入就绪队列（“优先权高优先”调度算法中）。
有些操作系统中增加了两种状态：新状态和终止状态



##### 5、某些操作系统中引入的进程的挂起状态（静止状态）

-- 挂起就绪、挂起阻塞；



##### 6、 <font color="blue"> 进程由哪些部分组成</font>，==进程控制块（PCB）的作用（P38）==：（进程表）

​	进程由**程序段、相关数据段和PCB**组成；
​	进程控制块是进程组成中最关键的部分，PCB是一个专门的数据结构，是**进程存在的唯一标志**，每个进程有唯一的PCB，操作系统根据PCB对进程实施控制和管理，PCB是进程存在的唯一标志。



##### 7、进程的切换（处理机从一个进程转到另一个进程）

​	可能引起进程切换的时机：进程运行结束、进程从运行态变为就绪态、进程从运行态变为等待态、进程从等待态变为就绪态；



##### ==<font color="blue">8、并发进程间两种相互制约关系：</font>==
​	“并发程序共享有限资源导致程序运行结果的不可再现性，所以引入同步和互斥”
​	什么是进程的同步（直接制约关系）与互斥（间接制约关系）：
​	进程的同步：进程间**共同完成一项任务时**直接发生相互作用的关系；（相互合作）
​	进程的互斥：两个逻辑上本来完全独立的进程由于**竞争同一个物理资源**而相互制约。（共享资源）



##### 9、多道程序设计概念：

​	多道程序设计是在一台计算机上同时运行两个或更多个程序，多道程序设计具有**提高系统资源利用率和增加作业吞吐量**的优点；缺点是**还没有考虑人机交互和周转时间**。



##### ==10、处理机的两种执行状态：==

​	管态和目态；即系统态、用户态



##### ==<font color="blue">11、引入进程和线程的作用</font>==

​	进程切换时需要同时切换的现场(栈、页表......)太多，为了提高程序并发执行的程度，以进一步改善系统的服务质量。
​	**引入进程**：为了使程序能够正确的**并发执行**，以**提高资源利用率和系统吞吐量**；
​	**引入线程**：为了**减小并发执行的时空开销**，**尽可能使OS具有更好的并发性**。
​	==线程之间的通信通过共享同一个进程内存区实现==


##### 12、线程的属性：

​	是一种轻型进程；
​	独立调度和分派的基本单位；可并发执行；共享所属进程所拥有的资源。




##### ==<font color="blue">13、线程</font>**是**调度的<font color="blue">基本单位（即是分配CPU的基本单位）</font>==

​	==**<font color="blue">进程</font>**是**资源分配的<font color="blue">基本单位</font>。**==

 

##### 14、什么是临界资源、临界区：

​	**临界资源**：一次仅允许一个进程使用的资源；
​	**临界区**：每个进程访问临界资源的那段代码。



##### ==<font color="blue">15、进程同步机制</font>应遵循的准则：==P55

​	空闲让进、忙则等待、有限等待(保证在有限时间内获得资源，不会饥饿)、让权等待(进程正在执行却无法访问临界区就要释放资源)。



##### <font color="blue">16、单处理机系统中的进程同步机制：</font>

​	**硬件同步机制、信号量机制和管程机制**（一种资源管理模块，由共享资源的数据结构、及其在该数据结构上的一组操作组成）。



##### 17、什么是信号量：

​	**信号量**：记录型信号量是**由两个成员组成的数据结构**，其中一个成员是**整型变量**，表示信号量的值，另一个是**进程链表L**，用于链接等待进程。信号量的值与相应资源的使用情况有关。

​	==最常用的信号量是记录型信号量，特点是防止CPU忙等的等待队列==

​	互斥信号量：初值为1；

​	资源信号量：初值为资源的数目；



##### ==18、P、V操作（也叫wait、signal操作）的解释：==

​	==P操作：信号量-1——>信号量小于0表示没有资源，block到阻塞队列==
​	当S.value>0时，表示目前系统中这类资源还有可用的。**执行一次**P**操作，意味着进程请求一个单位的该类资源**，使系统中可供分配的该类资源减少一个，因此描述为S.value:=S.value-1；当S.value<0时，表示该类资源已分配完毕，进程应调用block原语自我阻塞，放弃处理机，并插入到信号量链表S.L中。

​	==V操作：资源数+1——>是否小于等于0，是说明有阻塞进程，就唤醒==
​	**执行一次**V**操作，意味着释放一个单位的可用资源**，使系统中可供分配的该类资源数增加一个，故执行S.value:=S.value+1操作。若加1后S.value≤0，则表示在该信号量链表中，仍有等待该资源的进程被阻塞，因此应调用wakeup原语，将S.L链表中的第一个等待进程唤醒。



##### 19、三个**经典**的进程同步问题：

​	生产者-消费者问题能否将消费者进程的wait(full)和wait(mutex)语句互换，为什么？

​	不能。**因为这样可能导致系统死锁**。当系统中没有满缓冲时（full==0），消费者进程的wait(mutex)操作获取了缓冲队列的控制权，而wait(full) 导致消费者进程阻塞，这时生产者进程也无法执行。

​	**生产者-消费者问题、读者-写者问题、哲学家进餐问题**（不出现死锁），能够使用信号量及PV操作解决进程的同步问题。



##### ==20、进程通信—四种高级通信方式：==

​	共享存储器系统：数据结构/存储区
​	**消息传递系统**（以格式化的消息为单位）：直接通信方式（通信命令、原语）和间接通信方式（信箱，共享中间实体）
​	管道通信系统：pipe共享文件，字符流形式传输
​	客户机-服务器系统

	四种高级方式（大数据量）：消息队列、共享存储器、管程、客户机服务器
	低级通讯方式（只能是一个信号量）：信号量



##### 21、管程和条件变量

​	**管程由哪几部分组成**：管程名称、局部于管程的共享数据结构说明、对该数据结构进行操作的一组操作过程、初始化代码；

​	**为什么要引入条件变量**：（条件变量的类型是condition，是指向等待该条件的PCB的指针），当一个进程调用了管程，又因为某些原因被阻塞或挂起，在此期间如果不释放管程，其他进程也无法进入管程，被迫忙等。为解决这个问题，引入条件变量，每个条件变量可以保存一个链表，记录因该条件变量而阻塞的所有进程，阻塞时可将管程释放给其他进程使用，当条件满足时再将阻塞进程唤醒，使用管程。



##### 22、进程同步的例题：(多做相关题目，见附件)（==当一个进程问题同时包含同步和互斥时就需要记录型信号量了==）

​	例1 父亲Father、女儿Daughter、儿子Son互斥使用一个包含20个格子的容器。Father每次取一个水果（苹果或香蕉），用putfruit()把水果送入容器的某一个空格子中；Daughter每次用getapple()从该容器中取出一个苹果并用countapple()统计苹果的个数；Son每次用getbanana()从该容器中取出一个香蕉并用countbanana()统计香蕉的个数。请用信号量机制实现三者的同步与互斥活动。

参考答案：

```
semaphore mutex=1;
semophore apple=0,banana=0;
semophore empty=20;

main(){ 
	cobegin{ 
		进程Father：
		While(true){ //取水果;
  			P(empty);
  			P(mutex);
  			putfruit();
  			V(mutex);
  			If 水果是苹果 V(apple);
  			else V(banana);
		}

		进程Daughter：
		While(true){ 
			P(apple);
  			P(mutex);
  			getapple();
  			V(mutex);
  			V(empty);
  			countapple();
		}
		
		进程Son：
		While(true){ 
			P(banana);
  			P(mutex);
  			getbanana();
  			V(mutex);
			V(empty);
  			countbanana();
		}
 	}
	coend.
}
```

​	例2 某寺庙，有小和尚、老和尚若干。有一水缸，由小和尚用水桶从井中提水入缸，老和尚用水桶从缸里取水饮用。水缸可容10桶水，水取自同一井中。水井径窄，每次只能容一个水桶取水。水桶总数为3个。每次入、取缸水仅为1桶，且不可以同时进行。试用P、V操作给出小和尚、老和尚动作的算法描述。

分析：
   小和尚从井中取水并向缸中倒水为一个进程，而老和尚从缸中取水为另一个进程。
   有关互斥的资源有：
   水井（一次仅允许一个水桶进出）；
   水缸（一次倒水、取水仅一个水桶）。
   分别为它们设置信号量mutex1、mutex2来实现互斥，初值均为1。

有关同步的问题是：
   3个水桶----无论是从井中取水还是倒水入缸或取水出缸都是一次一个，即为其设置信号量count，初值为3，抢不到水桶的进程只好等待。
   此外，设置信号量empty来控制入缸的水量，初值为10，当水缸满时不可入水；设置信号full控制出缸的水量，初值为0，当水缸空时不可出水。

参考答案：

```
Begin
   mutex1:=1;mutex2:=1;
   empty:=10;full:=0;
   count:=3;
   Cobegin
     小和尚i（i=1,2,…）打水；
     老和尚j（j=1,2,…）取水；
   Coend;
End.

小和尚i（i＝1,2,…）打水:
Begin
   Repeat
   P(empty);    /*看水缸满否,满则阻塞打水进程*/
   P(count);    /*申请打水的桶*/
   P(mutex1);/*互斥使用水井,即不允许两和尚同时打水*/
   
   从井中取水；
   V(mutex1);
   P(mutex2);   /*互斥使用水缸*/
   
   送水入缸;
   V(mutex2);
   V(count);   /*归还水桶*/
   V(full)    /*水缸又多一桶水*/
  Until false
End;

老和尚j(j=1,2,…)取水:
Begin
  Repeat
   P(full);  /*看水缸是否有水，无水则阻塞取水进程*/
   P(count);   /*申请取水的桶*/
   P(mutex2);  /*互斥使用水缸*/

   从缸中取水；
   V(mutex2);
   V(count)   /*归还水桶*/
   V(empty);   /*缸中少了一桶水*/
  Until false
End.
```

​	例3 柜员与顾客问题（生产者-消费者问题）

![](%E6%9C%9F%E6%9C%AB%E5%A4%8D%E4%B9%A0%E6%8C%87%E5%AF%BC_%E4%BA%8C_%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/image-20231211144723083.png)



​	==例4 学生与监考老师问题（读者-写者问题）:把学生和监考老师都看做进程，学生有 N 个人，教归 l 个人，考场门口每次只能进出一个人，进考场的原则是先来先进，当 N个学生都进入考场后，教师才能发试卷。学生交卷后可以离开考场，教师要等收上来全部试卷并封装试卷后才能离开考场。==
​	试问：
​	1 ）共需没置几个进程？
​	2 ）试用 pv 操作解决上述问题。
 ![](%E6%9C%9F%E6%9C%AB%E5%A4%8D%E4%B9%A0%E6%8C%87%E5%AF%BC_%E4%BA%8C_%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/image-20231211144856745.png)
​	如果是存在同步现象，为了避免两个同类进程同时修改同一变量，需要加上互斥锁。
​	本题ready变量可以省去，只用while（count！=0）、while（count！=N)表示



​	例5：某博物馆最多可容纳 500 人同时参观，有一出入口一次仅允许一人通过，参观者的活动描述如下：
​	cobegin
​		参观者进程i：
​		{
​			...
​			进门
​			...
​			参观
​			...
​			出门
​			...
​		}
​	coend
请添加必要的信号量和 P 、 V [或 wait() 、 signal() ]搡作，以实现上述过程
![](%E6%9C%9F%E6%9C%AB%E5%A4%8D%E4%B9%A0%E6%8C%87%E5%AF%BC_%E4%BA%8C_%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/image-20231216135035556.png)





![](%E6%9C%9F%E6%9C%AB%E5%A4%8D%E4%B9%A0%E6%8C%87%E5%AF%BC_%E4%BA%8C_%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/image-20231216135256382.png)

![](%E6%9C%9F%E6%9C%AB%E5%A4%8D%E4%B9%A0%E6%8C%87%E5%AF%BC_%E4%BA%8C_%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/image-20231216135313396.png)