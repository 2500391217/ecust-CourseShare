# 计算机体系结构

## 前言
> 对于包含 &check; 的符号，姑且算作本文的重点内容。
> 不太确定。

[toc]

## 题型介绍

```题目数量/总共分数```

|	题型	|	题目数量	|	总分	|
|:------:|:------:|--------|
|选择题|5题|10分|
|填空题|25空|25分|
|简答题|5题|30分|
计算分析题|3题|35分|

## Chapter 1	量化分析设计基础
[目录](# 计算机体系结构)

### 复习要点

1.	计算机设计目标：性能、性价比、性能功率比
2.	计算分类：SISD、SIMD、MISD、MIMD
3.	晶体管动态功耗的含义、因素
4.	系统可靠性：MTBF、MTTF、MTTR的计算
5.	计算机设计遵循的基本原则[&check;]
   +	局部性原理
   +	利用并行性
   +	聚焦一般情况
6.	等效`CPI`、`Amdahl`定律及计算



####	弗林分类法

SISD、SIMD、MIMD、MISD

其中I为指令`instruction`, D为数据`Data`  
故SISD为单指令流单数据流



1. 并行的四种层次分别是什么，请给出相应的技术例子。

    > 1. ILP(Instruction Level Parallelism,指令级并行性)
    >
    >     > 提升性能遇到瓶颈，挖掘空间不大
    >     >
    >     > 乱序执行、多发射、编译器优化、分支预测、ROB、寄存器重命名等
    >     >
    > 2. DLP(Data Level Parallelism) 数据级并行性
    >
    >     > 指令级并行的有效补充，在高性能计算及流媒体等领域发挥重要作用，在专用处理器中应用较多
    >     > 向量机、SIMD多媒体扩展、GPU
    >     >
    > 3. TLP(Thread Level Parallelism) 线程级并行性
    >
    >     > 线程级并行大量存在于Internet应用,是目前研究热点
    >     > 多核处理器、多处理机、多线程处理器
    >     >
    > 4. RLP(Request Level Parallelism)请求级并行性
    >
2. 计算机按照弗林分类法分成哪四类，请分别给出例子。

    > 1. SISD (single instruction stream, single data stream)单指令流单数据流
    > 2. SIMD (single instruction stream, multiple data stream)单指令流多数据流
    >
    >     > 向量机 多媒体扩展处理 GPU
    >     >
    > 3. MIMD (multiple instruction stream, multiple data stream)多指令流多数据流
    >
    >     > 紧耦合MIMD: SMP、DSM
    >     > 松散耦合MIMD: 机群cluster
    >     >
    > 4. MISD (multiple instruction stream, single data stream)多指令流单数据流
    >
    >     > 数据流处理机 无商业产品
    >     >
    >
3. 计算机设计遵循的原则有哪些？

    > 1. 利用并行性：比如多处理器、多个硬盘、流水线、多个功能部件
    >
    >     > 对于服务器，将请求平衡分发到不同的处理器和硬盘，提升服务器吞吐率
    >     >
    >     > 将数据分布存储到不同硬盘，以便并行读写数据，实现数据层次并行性(data-level parallelism)
    >     >
    >     > 对于单个处理器，挖掘指令并行性，对获得高性能极为重要，比如利用流水线技术
    >     >
    > 2. 局部性原理：程序趋向于充分使用最近用过的指令和数据
    >
    >     > 程序趋向于充分使用最近用过的指令和数据，应用实例：TLB、Cache、预取
    >     >
    >     > 一个广泛认同的公理：程序会将90%的执行时间花费在仅仅10%的代码上。
    >     >
    >     > 根据程序近期访问来预测不久未来程序要访问的指令和数据，具有很高的预测正确率
    >     >
    > 3. 聚焦于一般情况：在进行设计平衡时，优先考虑经常情况而不是特殊情况
    >
    >     > 在确定资源分配时，采用上述原则，因为优先考虑一般情况会带来更高的性能提升。
    >     >
    >     > Amdahl定律：描述系统的某些部件改进后(执行时间变少)，整个系统的加速比(性能提升)
    >     >
    >     > 该定律可用于衡量某些部件改进能提升多少系统性能，指导如何有效地分配资源以更好提升系统性能
    >     >
    >     > Amdahl定律可用于比较两种不同处理器设计方案的好坏
    >     >
    >
4. 局部性包括哪两种局部性，请做出解释。

    > **时间局部性**：近期被访问的数据和指令有可能在不久会被再次访问
    >
    > **空间局部性**：地址邻近的数据和指令倾向于差不多同时被访问
    >
5. 请举例提高功耗效率的方法。

    > 1. 以逸待劳：微处理器关掉空闲模块的时钟以节约能耗
    > 2. **DVFS：在服务低活跃期，处理器使用较低的电压和时钟频率**
    > 3. 针对典型情况进行设计
    > 4. **超频：在这种模式下，芯片可以判定在少数CPU核上以更高的频率运行小段时间是安全，直到温度开始上升执行单线程代码，微处理器关掉多余的核，只留下一个CPU核并以更高主频(超过额定频率)运行**
    >
6. 体系结构的研究内容包括哪些？

    > 包括ISA、硬件、微结构。
    >
    > 在设计时，在价格、可获得性、功耗等条件约束下，最大化性能。
    >
7. 现代一些微处理器设计采用可调电压，电压下降15%可能导致频率下降15%，这对动态能耗和动态功率有什么影响？

    > 由于电容不变，能耗变化就是电压平方之比：
    >
    > `能耗_新/能耗_原=(电压×0.85)^2/电压^2=0.85^2 =0.72`
    >
    > 能耗下降为72%。对于功率，需要考虑频率变化：
    >
    > `新功率/原功率=0.72×开关频率×0.85/开关频率=0.61`
    >
8. 设磁盘子系统组件和MTTF如下，求系统的MTTF。

    > 10个磁盘，每个MTTF=1 000 000小时
    > 1个ATA控制器，MTTF=500 000小时
    > 1个电源，MTTF=200 000小时
    > 1个风扇， MTTF=200 000小时
    > 1根ATA电缆，MTTF= 1000 000小时
    >

    假设各个故障源互相独立，整个系统故障率是各个组件故障率之和。

    > 系统故障率=10×1/1 000 000+1/500 000+1/200 000+1/200 000+1/100 0000 = 10+2+5+5+1/1 000 000=23/1 000 000=23000/1000 000 000小时
    >
    > 系统MTTF=1/系统故障率=1 000 000 000/23 000 =43500小时
    >
9. 在前面例子中系统增加一个备用电源，系统的MTTF变为多少？

    > 假设系统组件发生故障相互独立。新系统(双电源系统，或者电源对系统)其中一个电源发生故障时，由于第二个电源的保障，系统依然能够正常工作。当一个电源发生故障，没有来得及修理，第二电源也发生故障，这时系统发生故障。
    >
    > p1×p2=2/MMTF×MTTR/MTTF => MTTF^2/2∗MTTR
    >
10. 假设我们希望升级一个提供Web服务的处理器。新处理器的计算速度是旧处理器的10倍。假定原处理器有40%的时间用于计算，60%的时间等待I/O操作。进行升级后，总加速比是多少？

     > 升级比例 0.4 ，升级加速比 10，所以总的加速比
     >
     > 1/0.6+0.4/10=1/0.64≈1.56
     >
11. 图形处理器经常需要求平方根，比较以下两种设计方案。

     > 第一种将浮点平方根(FPSQR)硬件加速到原来的10倍，FPSQR占据了原来总执行时间的20%，另外一种设计方案，将所有的FP浮点运算速度提高到原来的1.6倍，浮点运算占据原执行时间比利为50%。
     >

     > 通过计算加速比来比较两种设计方案
     > 加速比_FPSQR=1/(1−0.2)+0.2/10=1/0.82=1.22
     > 加速比_FP=1/(1−0.5)+0.5/1.6=1/0.8125=1.23
     >
     > 提高整体FP浮点运算速度的方案稍好一些，因为它的使用频率要高一些
     >
12. 假设有以下情况，用处理器性能公式对比两种方案。

     > FP运算频率=25%， FP运算的CPI=4，其他指令的CPI=1.33
     > FPSQR运算(浮点平方根)频率=2%，FPSQR的CPI=20
     > 有两种设计方案，一种方案将FPSQR的CPI降至2。另外一 种将
     > 所有FP运算CPI降至2.5
     >

     > 仅有CPI发生改变，指令条数和时钟周期不变。没改进前的原CPI：
     >
     > 原CPI=∑CPI_i×(IC_i/指令数)=(4×25%)+(1.33×75%)=2
     >
     > 可以用原CPI减去节省的周期数得到改进FPSQR后的CPI
     >
     > CPI_改进FPSQR后=CPI_原−2%×(CPI_旧FPSQR−CPI_新FPSQR)
     >                                =2.0-2%×(20-2)=1.64
     >
     > 对所有的FP改进后的CPI为：
     >
     >     CPI_{新FP} = (75%×1.33) + (25%×2.5) = 1.625 
     >
     > 对所有FP改进后的CPI低一些，这种方案的效果好一些。该种方案的加速比为
     >
     > 加速比_新FP=CPU时间_原/CPU时间_新FP=IC×时钟周期×CPI_原/IC×时钟周期×CPI_新FP=CPI_原/CPI_新FP=2/1.625=1.23

## Chapter 2	流水线

[目录](# 计算机体系结构)

### 复习要点
1.	RISC主流指令集：`ARM`、`RISC-V`、`MIPS LoongArch`
2.	流水线性能指标: 吞吐率，加速比，效率
3.	分支延迟转移
4.	分治预测： 动态、静态、转移方向
5.	多周期5段RISC流水线分析

## Chapter 3	指令并行性

[目录](# 计算机体系结构)

### 复习要点
1.	名称相关
	1.	反相关
	2.	输出相关
2.	结构冒险、控制相关
3.	数据冒险：WAW,WAR,RAW
4.	相关预测
	+	`gshare`预测器
5.	竞赛预测器
6.	`Tomasulo`算法指令动态调度分析及其例子
7.	带`ROB`的`Tomasulo`动态调度分析及其例子
8.	寄存器重命名 $\rightarrow$ WAW, WAR
9.	处理器微结构[&check;]
	1.	顺序发射
	2.	顺序提交
	3.	乱序执行
10.	循环展开局限性
11.	多发射过程

## Chapter 4	存储器层次结构

[目录](# 计算机体系结构)

### 复习要点
1.	存储器层次结构->存储墙
2.	Cache高级优化方法：提高Cache带宽[&check;]
	1.	分组结构
	2.	无阻塞结构
	3.	流水线结构
3.	Cache映射
	1.	直接相联
	2.	组相联
	3.	全相联
4.	Cache替换方法
	1.	FIFO
	2.	LRU
	3.	随机
5.	Cache更新方法的比较
	1.	写回法
	2.	写直达法

## Chapter 5	数据级并行性
[目录](# 计算机体系结构)

### 复习要点
1.	挖掘数据级并行性三种结构[&check;]
	1.	GPU
	2.	向量机
	3.	SIMD多媒体扩展
2.	SIMD多媒体扩展：SSE,NMX,AVX
3.	GPU的调度器
4.	SIMD多媒体扩展与向量机的不同
5.	屋脊线Roofline性能模型
6.	向量机：集中-分散操作

## Chapter 6	线程级并行性
[目录](# 计算机体系结构)

### 复习要点
1.	消息传递系统、共享存储器系统  
2.	LLC
3.	Cache一致性
4.	监听协议和目录协议、使用场景、优劣
5.	互连网络
6.	硬件多线程
7.	粗粒度多线程[&check;]
8.	细粒度多线程[&check;]
9.	SMT同时多线程[&check;]